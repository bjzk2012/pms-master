package cn.kcyf.pms.modular.business.controller;

import cn.kcyf.commons.http.SimpleClient;
import cn.kcyf.commons.http.TApi;
import cn.kcyf.commons.http.enumerate.DataType;
import cn.kcyf.commons.http.enumerate.RequestMethod;
import cn.kcyf.commons.web.RequestUtils;
import cn.kcyf.pms.core.enumerate.DayType;
import cn.kcyf.pms.modular.system.dao.HolidayDao;
import cn.kcyf.pms.modular.system.entity.Holiday;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Controller
@RequestMapping("test")
public class TestController {
    private static List<String> list = new ArrayList<>();
    static{
        list.add("2019-01-01");
        list.add("2019-01-02");
        list.add("2019-01-03");
        list.add("2019-01-04");
        list.add("2019-01-05");
        list.add("2019-01-06");
        list.add("2019-01-07");
        list.add("2019-01-08");
        list.add("2019-01-09");
        list.add("2019-01-10");
        list.add("2019-01-11");
        list.add("2019-01-12");
        list.add("2019-01-13");
        list.add("2019-01-14");
        list.add("2019-01-15");
        list.add("2019-01-16");
        list.add("2019-01-17");
        list.add("2019-01-18");
        list.add("2019-01-19");
        list.add("2019-01-20");
        list.add("2019-01-21");
        list.add("2019-01-22");
        list.add("2019-01-23");
        list.add("2019-01-24");
        list.add("2019-01-25");
        list.add("2019-01-26");
        list.add("2019-01-27");
        list.add("2019-01-28");
        list.add("2019-01-29");
        list.add("2019-01-30");
        list.add("2019-01-31");
        list.add("2019-02-01");
        list.add("2019-02-02");
        list.add("2019-02-03");
        list.add("2019-02-04");
        list.add("2019-02-05");
        list.add("2019-02-06");
        list.add("2019-02-07");
        list.add("2019-02-08");
        list.add("2019-02-09");
        list.add("2019-02-10");
        list.add("2019-02-11");
        list.add("2019-02-12");
        list.add("2019-02-13");
        list.add("2019-02-14");
        list.add("2019-02-15");
        list.add("2019-02-16");
        list.add("2019-02-17");
        list.add("2019-02-18");
        list.add("2019-02-19");
        list.add("2019-02-20");
        list.add("2019-02-21");
        list.add("2019-02-22");
        list.add("2019-02-23");
        list.add("2019-02-24");
        list.add("2019-02-25");
        list.add("2019-02-26");
        list.add("2019-02-27");
        list.add("2019-02-28");
        list.add("2019-03-01");
        list.add("2019-03-02");
        list.add("2019-03-03");
        list.add("2019-03-04");
        list.add("2019-03-05");
        list.add("2019-03-06");
        list.add("2019-03-07");
        list.add("2019-03-08");
        list.add("2019-03-09");
        list.add("2019-03-10");
        list.add("2019-03-11");
        list.add("2019-03-12");
        list.add("2019-03-13");
        list.add("2019-03-14");
        list.add("2019-03-15");
        list.add("2019-03-16");
        list.add("2019-03-17");
        list.add("2019-03-18");
        list.add("2019-03-19");
        list.add("2019-03-20");
        list.add("2019-03-21");
        list.add("2019-03-22");
        list.add("2019-03-23");
        list.add("2019-03-24");
        list.add("2019-03-25");
        list.add("2019-03-26");
        list.add("2019-03-27");
        list.add("2019-03-28");
        list.add("2019-03-29");
        list.add("2019-03-30");
        list.add("2019-03-31");
        list.add("2019-04-01");
        list.add("2019-04-02");
        list.add("2019-04-03");
        list.add("2019-04-04");
        list.add("2019-04-05");
        list.add("2019-04-06");
        list.add("2019-04-07");
        list.add("2019-04-08");
        list.add("2019-04-09");
        list.add("2019-04-10");
        list.add("2019-04-11");
        list.add("2019-04-12");
        list.add("2019-04-13");
        list.add("2019-04-14");
        list.add("2019-04-15");
        list.add("2019-04-16");
        list.add("2019-04-17");
        list.add("2019-04-18");
        list.add("2019-04-19");
        list.add("2019-04-20");
        list.add("2019-04-21");
        list.add("2019-04-22");
        list.add("2019-04-23");
        list.add("2019-04-24");
        list.add("2019-04-25");
        list.add("2019-04-26");
        list.add("2019-04-27");
        list.add("2019-04-28");
        list.add("2019-04-29");
        list.add("2019-04-30");
        list.add("2019-05-01");
        list.add("2019-05-02");
        list.add("2019-05-03");
        list.add("2019-05-04");
        list.add("2019-05-05");
        list.add("2019-05-06");
        list.add("2019-05-07");
        list.add("2019-05-08");
        list.add("2019-05-09");
        list.add("2019-05-10");
        list.add("2019-05-11");
        list.add("2019-05-12");
        list.add("2019-05-13");
        list.add("2019-05-14");
        list.add("2019-05-15");
        list.add("2019-05-16");
        list.add("2019-05-17");
        list.add("2019-05-18");
        list.add("2019-05-19");
        list.add("2019-05-20");
        list.add("2019-05-21");
        list.add("2019-05-22");
        list.add("2019-05-23");
        list.add("2019-05-24");
        list.add("2019-05-25");
        list.add("2019-05-26");
        list.add("2019-05-27");
        list.add("2019-05-28");
        list.add("2019-05-29");
        list.add("2019-05-30");
        list.add("2019-05-31");
        list.add("2019-06-01");
        list.add("2019-06-02");
        list.add("2019-06-03");
        list.add("2019-06-04");
        list.add("2019-06-05");
        list.add("2019-06-06");
        list.add("2019-06-07");
        list.add("2019-06-08");
        list.add("2019-06-09");
        list.add("2019-06-10");
        list.add("2019-06-11");
        list.add("2019-06-12");
        list.add("2019-06-13");
        list.add("2019-06-14");
        list.add("2019-06-15");
        list.add("2019-06-16");
        list.add("2019-06-17");
        list.add("2019-06-18");
        list.add("2019-06-19");
        list.add("2019-06-20");
        list.add("2019-06-21");
        list.add("2019-06-22");
        list.add("2019-06-23");
        list.add("2019-06-24");
        list.add("2019-06-25");
        list.add("2019-06-26");
        list.add("2019-06-27");
        list.add("2019-06-28");
        list.add("2019-06-29");
        list.add("2019-06-30");
        list.add("2019-07-01");
        list.add("2019-07-02");
        list.add("2019-07-03");
        list.add("2019-07-04");
        list.add("2019-07-05");
        list.add("2019-07-06");
        list.add("2019-07-07");
        list.add("2019-07-08");
        list.add("2019-07-09");
        list.add("2019-07-10");
        list.add("2019-07-11");
        list.add("2019-07-12");
        list.add("2019-07-13");
        list.add("2019-07-14");
        list.add("2019-07-15");
        list.add("2019-07-16");
        list.add("2019-07-17");
        list.add("2019-07-18");
        list.add("2019-07-19");
        list.add("2019-07-20");
        list.add("2019-07-21");
        list.add("2019-07-22");
        list.add("2019-07-23");
        list.add("2019-07-24");
        list.add("2019-07-25");
        list.add("2019-07-26");
        list.add("2019-07-27");
        list.add("2019-07-28");
        list.add("2019-07-29");
        list.add("2019-07-30");
        list.add("2019-07-31");
        list.add("2019-08-01");
        list.add("2019-08-02");
        list.add("2019-08-03");
        list.add("2019-08-04");
        list.add("2019-08-05");
        list.add("2019-08-06");
        list.add("2019-08-07");
        list.add("2019-08-08");
        list.add("2019-08-09");
        list.add("2019-08-10");
        list.add("2019-08-11");
        list.add("2019-08-12");
        list.add("2019-08-13");
        list.add("2019-08-14");
        list.add("2019-08-15");
        list.add("2019-08-16");
        list.add("2019-08-17");
        list.add("2019-08-18");
        list.add("2019-08-19");
        list.add("2019-08-20");
        list.add("2019-08-21");
        list.add("2019-08-22");
        list.add("2019-08-23");
        list.add("2019-08-24");
        list.add("2019-08-25");
        list.add("2019-08-26");
        list.add("2019-08-27");
        list.add("2019-08-28");
        list.add("2019-08-29");
        list.add("2019-08-30");
        list.add("2019-08-31");
        list.add("2019-09-01");
        list.add("2019-09-02");
        list.add("2019-09-03");
        list.add("2019-09-04");
        list.add("2019-09-05");
        list.add("2019-09-06");
        list.add("2019-09-07");
        list.add("2019-09-08");
        list.add("2019-09-09");
        list.add("2019-09-10");
        list.add("2019-09-11");
        list.add("2019-09-12");
        list.add("2019-09-13");
        list.add("2019-09-14");
        list.add("2019-09-15");
        list.add("2019-09-16");
        list.add("2019-09-17");
        list.add("2019-09-18");
        list.add("2019-09-19");
        list.add("2019-09-20");
        list.add("2019-09-21");
        list.add("2019-09-22");
        list.add("2019-09-23");
        list.add("2019-09-24");
        list.add("2019-09-25");
        list.add("2019-09-26");
        list.add("2019-09-27");
        list.add("2019-09-28");
        list.add("2019-09-29");
        list.add("2019-09-30");
        list.add("2019-10-01");
        list.add("2019-10-02");
        list.add("2019-10-03");
        list.add("2019-10-04");
        list.add("2019-10-05");
        list.add("2019-10-06");
        list.add("2019-10-07");
        list.add("2019-10-08");
        list.add("2019-10-09");
        list.add("2019-10-10");
        list.add("2019-10-11");
        list.add("2019-10-12");
        list.add("2019-10-13");
        list.add("2019-10-14");
        list.add("2019-10-15");
        list.add("2019-10-16");
        list.add("2019-10-17");
        list.add("2019-10-18");
        list.add("2019-10-19");
        list.add("2019-10-20");
        list.add("2019-10-21");
        list.add("2019-10-22");
        list.add("2019-10-23");
        list.add("2019-10-24");
        list.add("2019-10-25");
        list.add("2019-10-26");
        list.add("2019-10-27");
        list.add("2019-10-28");
        list.add("2019-10-29");
        list.add("2019-10-30");
        list.add("2019-10-31");
        list.add("2019-11-01");
        list.add("2019-11-02");
        list.add("2019-11-03");
        list.add("2019-11-04");
        list.add("2019-11-05");
        list.add("2019-11-06");
        list.add("2019-11-07");
        list.add("2019-11-08");
        list.add("2019-11-09");
        list.add("2019-11-10");
        list.add("2019-11-11");
        list.add("2019-11-12");
        list.add("2019-11-13");
        list.add("2019-11-14");
        list.add("2019-11-15");
        list.add("2019-11-16");
        list.add("2019-11-17");
        list.add("2019-11-18");
        list.add("2019-11-19");
        list.add("2019-11-20");
        list.add("2019-11-21");
        list.add("2019-11-22");
        list.add("2019-11-23");
        list.add("2019-11-24");
        list.add("2019-11-25");
        list.add("2019-11-26");
        list.add("2019-11-27");
        list.add("2019-11-28");
        list.add("2019-11-29");
        list.add("2019-11-30");
        list.add("2019-12-01");
        list.add("2019-12-02");
        list.add("2019-12-03");
        list.add("2019-12-04");
        list.add("2019-12-05");
        list.add("2019-12-06");
        list.add("2019-12-07");
        list.add("2019-12-08");
        list.add("2019-12-09");
        list.add("2019-12-10");
        list.add("2019-12-11");
        list.add("2019-12-12");
        list.add("2019-12-13");
        list.add("2019-12-14");
        list.add("2019-12-15");
        list.add("2019-12-16");
        list.add("2019-12-17");
        list.add("2019-12-18");
        list.add("2019-12-19");
        list.add("2019-12-20");
        list.add("2019-12-21");
        list.add("2019-12-22");
        list.add("2019-12-23");
        list.add("2019-12-24");
        list.add("2019-12-25");
        list.add("2019-12-26");
        list.add("2019-12-27");
        list.add("2019-12-28");
        list.add("2019-12-29");
        list.add("2019-12-30");
        list.add("2019-12-31");
    }
    @Autowired
    private HolidayDao holidayDao;
    @RequestMapping("/holiday")
    @ResponseBody
    public Boolean holiday(){
        for (String key : list){
            Holiday holiday = new Holiday();
            holiday.setDay(key);
            holidayDao.save(holiday);
        }
        List<Holiday> list = holidayDao.findAll();
        for (Holiday holiday: list){
            TApi tApi = new TApi("http://timor.tech/api/holiday/info/"+holiday.getDay(), RequestMethod.GET, DataType.JSON, "");
            SimpleClient client = new SimpleClient();
            JSONObject result = JSON.parseObject(client.send(tApi, null));
            JSONObject types = result.getJSONObject("type");
            holiday.setName(types.getString("name"));
            holiday.setType(DayType.valueOfOrdinal(types.getInteger("type")));
            holiday.setWeek(types.getInteger("week"));
            holidayDao.save(holiday);
        }
        return Boolean.TRUE;
    }
}
